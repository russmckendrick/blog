---
import BaseLayout from '../layouts/BaseLayout.astro';
import Search from 'astro-pagefind/components/Search';

const isDev = import.meta.env.DEV;
---

<BaseLayout title="Search" description="Search Russ.Cloud blog posts and content">
	<div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
		<section class="border-b border-gray-200 pb-8 pt-8 text-center dark:border-gray-700 md:pb-12 md:pt-12">
			<h1 class="mb-2 text-3xl font-bold text-gray-900 dark:text-gray-100 md:text-4xl">
				Search
			</h1>
			<p class="text-lg text-gray-600 dark:text-gray-400 md:text-xl">
				Find articles, tutorials, and insights
			</p>
		</section>

		{isDev && (
			<div class="mt-6 rounded-lg border border-amber-400 bg-amber-50 px-4 py-3 text-amber-800 dark:border-amber-500 dark:bg-amber-950 dark:text-amber-200">
				<p>
					<strong>Development Mode:</strong> Search requires a production build to index content. Run{' '}
					<code class="rounded bg-amber-200/50 px-1.5 py-0.5 font-mono text-sm dark:bg-amber-800/50">npm run build</code>{' '}
					and{' '}
					<code class="rounded bg-amber-200/50 px-1.5 py-0.5 font-mono text-sm dark:bg-amber-800/50">npm run preview</code>{' '}
					to test search functionality.
				</p>
			</div>
		)}

		<section class="py-6 md:py-8">
			<Search
				id="search"
				className="pagefind-ui"
				uiOptions={{ showImages: false, excerptLength: 15 }}
			/>
		</section>
	</div>
</BaseLayout>

<script>
	// Reinitialize Pagefind after View Transitions navigation
	function initPagefind() {
		const searchElement = document.querySelector('.pagefind-ui');
		if (searchElement && window.PagefindUI) {
			// Clear existing content
			searchElement.innerHTML = '';
			// Reinitialize
			new window.PagefindUI({
				element: searchElement,
				showImages: false,
				excerptLength: 15
			});
		}
	}

	// Initialize on first load
	initPagefind();

	// Re-initialize after View Transitions navigation
	document.addEventListener('astro:page-load', initPagefind);
</script>

<style is:global>
	/* Pagefind UI Theme Variables - Light Mode */
	:root {
		--pagefind-ui-scale: 1;
		--pagefind-ui-primary: #1f2937;      /* gray-800 */
		--pagefind-ui-text: #374151;          /* gray-700 */
		--pagefind-ui-background: #ffffff;
		--pagefind-ui-border: #e5e7eb;        /* gray-200 */
		--pagefind-ui-tag: #f3f4f6;           /* gray-100 */
		--pagefind-ui-border-radius: 0.5rem;
	}

	/* Pagefind UI Theme Variables - Dark Mode */
	.dark {
		--pagefind-ui-primary: #f3f4f6;       /* gray-100 */
		--pagefind-ui-text: #d1d5db;          /* gray-300 */
		--pagefind-ui-background: #111827;    /* gray-900 */
		--pagefind-ui-border: #374151;        /* gray-700 */
		--pagefind-ui-tag: #1f2937;           /* gray-800 */
	}

	/* Search Input Focus States */
	.pagefind-ui__search-input {
		transition: border-color 0.2s ease, box-shadow 0.2s ease;
	}

	.pagefind-ui__search-input:focus {
		border-color: #3b82f6 !important;     /* blue-500 */
		box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15);
		outline: none;
	}

	.dark .pagefind-ui__search-input:focus {
		border-color: #60a5fa !important;     /* blue-400 */
		box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
	}

	/* Result Link Hover Effects */
	.pagefind-ui__result-link {
		transition: color 0.15s ease;
	}

	.pagefind-ui__result-link:hover {
		color: #2563eb !important;            /* blue-600 */
	}

	.dark .pagefind-ui__result-link:hover {
		color: #60a5fa !important;            /* blue-400 */
	}

	/* Search Term Highlight Styling */
	.pagefind-ui mark {
		background-color: #fef08a;            /* yellow-200 */
		color: inherit;
		padding: 0.1em 0.2em;
		border-radius: 0.125rem;
	}

	.dark .pagefind-ui mark {
		background-color: #854d0e;            /* yellow-800 */
		color: #fef9c3;                       /* yellow-100 */
	}

	/* Clear Button Styling */
	.pagefind-ui__search-clear {
		transition: color 0.15s ease;
	}

	.pagefind-ui__search-clear:hover {
		color: #1f2937 !important;            /* gray-800 */
	}

	.dark .pagefind-ui__search-clear:hover {
		color: #f3f4f6 !important;            /* gray-100 */
	}

	/* Load More Button Styling */
	.pagefind-ui__button {
		transition: border-color 0.2s ease, background-color 0.2s ease, color 0.2s ease;
	}

	.pagefind-ui__button:hover {
		border-color: #3b82f6 !important;     /* blue-500 */
		color: #2563eb !important;            /* blue-600 */
	}

	.dark .pagefind-ui__button:hover {
		border-color: #60a5fa !important;     /* blue-400 */
		color: #60a5fa !important;            /* blue-400 */
	}

	/* Mobile Responsive Adjustments */
	@media (max-width: 640px) {
		.pagefind-ui__search-input {
			font-size: calc(18px * var(--pagefind-ui-scale)) !important;
			height: calc(56px * var(--pagefind-ui-scale)) !important;
		}

		.pagefind-ui__result-title {
			font-size: calc(18px * var(--pagefind-ui-scale)) !important;
		}

		.pagefind-ui__result-excerpt {
			font-size: calc(14px * var(--pagefind-ui-scale)) !important;
		}
	}
</style>
