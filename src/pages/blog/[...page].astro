---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/blog/PostCard.astro';
import Pagination from '../../components/layout/Pagination.astro';
import { getHeroColors, gradientStylesToString, getGradientStyles } from '../../utils/hero-colors';

export async function getStaticPaths({ paginate }) {
	const posts = (await getCollection('blog'))
		.filter(post => import.meta.env.DEV || !post.data.draft)
		.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

	return paginate(posts, { pageSize: 10 });
}

const { page } = Astro.props;

// Get gradient colors from first post's hero image
const firstPost = page.data[0];
const firstPostHeroImage = firstPost?.data.heroImage || firstPost?.data.cover?.image;
const heroColors = getHeroColors(firstPostHeroImage);
const gradientStyleString = gradientStylesToString(getGradientStyles(heroColors));
---

<BaseLayout title="Blog" description="All blog posts from Russ McKendrick">
	<!-- Hero gradient background from first post -->
	<section
		class="hero-gradient-section absolute inset-x-0 top-0 -z-10 h-[70vh] min-h-[450px]"
		style={gradientStyleString}
	>
		<div class="hero-gradient-bg absolute inset-0"></div>
	</section>
	<section class="text-center py-8 pb-12 mb-8 border-b border-gray-200 dark:border-gray-700">
		<h1 class="text-4xl lg:text-5xl font-bold mb-4 text-gray-900 dark:text-gray-100">Blog</h1>
		<p class="text-lg text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">Technical posts, thoughts, and ramblings about DevOps, automation, and cloud technologies.</p>
	</section>

	<section class="max-w-3xl mx-auto px-5">
			<ul class="space-y-12">
				{page.data.map((post) => (
					<li>
						<PostCard post={post} />
					</li>
				))}
			</ul>

			{page.total > page.size && (
				<Pagination
					currentPage={page.currentPage}
					totalPages={page.lastPage}
					getHref={(pageNum) => (pageNum === 1 ? '/blog/' : `/blog/${pageNum}/`)}
					hideIfSingle={false}
				/>
			)}
		</section>
</BaseLayout>
