---
interface Props {
  autoHide?: boolean;
}

const { autoHide = false } = Astro.props;
---

<div
  class="header-wrapper sticky top-0 z-50 focus:outline-none focus:ring-0 transition-transform duration-300 ease-in-out"
  data-auto-hide={autoHide}
>
  <slot />
</div>

<script>
  function initHeaderAutoHide() {
    const header = document.querySelector('.header-wrapper');
    if (!header) return;

    const autoHide = header.getAttribute('data-auto-hide') === 'true';
    if (!autoHide) return;

    let lastScrollY = window.scrollY;
    let ticking = false;
    let scrollTimeout: number | undefined;

    function updateHeader() {
      const currentScrollY = window.scrollY;

      // Add will-change only during active scrolling for better performance
      if (!scrollTimeout) {
        (header as HTMLElement).style.willChange = 'transform';
      }

      if (currentScrollY > 100) {
        if (currentScrollY > lastScrollY) {
          // Scrolling down - hide header
          (header as HTMLElement).style.transform = 'translateY(-100%)';
        } else {
          // Scrolling up - show header
          (header as HTMLElement).style.transform = 'translateY(0)';
        }
      } else {
        // Always show at top
        (header as HTMLElement).style.transform = 'translateY(0)';
      }

      lastScrollY = currentScrollY;
      ticking = false;

      // Remove will-change after scrolling stops (performance optimization)
      clearTimeout(scrollTimeout);
      scrollTimeout = window.setTimeout(() => {
        (header as HTMLElement).style.willChange = 'auto';
        scrollTimeout = undefined;
      }, 150);
    }

    function onScroll() {
      if (!ticking) {
        window.requestAnimationFrame(updateHeader);
        ticking = true;
      }
    }

    window.addEventListener('scroll', onScroll, { passive: true });

    // Cleanup on page navigation
    document.addEventListener('astro:before-swap', () => {
      window.removeEventListener('scroll', onScroll);
      clearTimeout(scrollTimeout);
    });
  }

  // Initialize on page load
  initHeaderAutoHide();

  // Re-initialize on View Transitions navigation
  document.addEventListener('astro:page-load', initHeaderAutoHide);
</script>

<style>
  .header-wrapper {
    /* will-change is added dynamically during scrolling for better performance */
    /* Ensure header is always visible and not affected by page transitions */
    view-transition-name: none !important;
    opacity: 1 !important;
  }

  /* Prevent View Transitions from hiding the header on initial load */
  @supports (view-transition-name: none) {
    .header-wrapper {
      contain: layout style paint;
    }
  }
</style>
